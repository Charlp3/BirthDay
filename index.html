<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BirthDay v4.5</title>

<style>
:root{
  --fond:#fdf4dd;
  --banniere-vivant:#f7c9d6;
  --banniere-mort:#d6caef;
  --texte:#3b2e07;
  --btn1:#f1c55b;
  --btn2:#de8b2a;
}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:var(--fond);
  color:var(--texte);
  margin:0;
}
header{
  background:#f1c55b;
  padding:8px;
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  align-items:center;
}
header span{
  font-weight:700;
}
button{
  background:linear-gradient(135deg,var(--btn1),var(--btn2));
  border:none;
  border-radius:10px;
  padding:6px 12px;
  font-weight:600;
  color:#2b1e00;
  box-shadow:0 2px 4px rgba(0,0,0,.2);
}
.banner{
  display:none;
  margin:10px;
  padding:10px;
  border-radius:12px;
  font-weight:600;
  text-align:center;
}
.banner.vivant{background:var(--banniere-vivant);}
.banner.mort{background:var(--banniere-mort);}
main{
  padding:10px;
}
table{
  width:100%;
  border-collapse:collapse;
  background:#fffef6;
  border-radius:10px;
  overflow:hidden;
}
th,td{
  border-bottom:1px solid rgba(0,0,0,.1);
  padding:6px 8px;
  font-size:14px;
}
th{background:#fff0b2;}
tr:nth-child(even){background:#fffaf0;}
.badge{
  background:#fff;
  border:1px solid rgba(0,0,0,.2);
  border-radius:50%;
  width:22px;height:22px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-size:13px;
  font-weight:700;
  margin-left:4px;
}
#bannerText strong{color:#000;}
footer{
  font-size:12px;
  text-align:center;
  margin:20px 0;
  color:#555;
}
</style>
</head>

<body>
<header>
  <div>
    <span>ğŸ‚ BirthDay v4.5</span>
    <span id="today"></span>
  </div>
  <div>
    ğŸ‘¤<span class="badge" id="humBadge">0</span>
    ğŸ•<span class="badge" id="dogBadge">0</span>
    <button id="btnExport">Sauvegarder CSV</button>
    <input type="file" id="btnImport" accept=".csv" style="display:none"/>
    <button id="btnImportShow">Importer CSV</button>
  </div>
</header>

<div id="banner" class="banner"></div>

<main>
<table id="table">
  <thead>
    <tr>
      <th>Nom</th><th>Type</th><th>Naissance</th><th>Ã‚ge</th>
      <th>DÃ©cÃ¨s</th><th>Ã‚ge au dÃ©cÃ¨s</th><th>Notes</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>
</main>

<footer>
Â© Pierre Charlier 2025 Â· Local & privÃ© Â· BirthDay ğŸ‚ Â· Format JJ/MM/AAAA
</footer>

<script>
const KEY="birthday_famille_v1";

/* === utilitaires === */
function fmtDateFr(d){
  if(!d)return"";
  if(/^\d{2}\/\d{2}\/\d{4}$/.test(d))return d;
  const o=new Date(d);
  if(isNaN(o))return"";
  return String(o.getDate()).padStart(2,"0")+"/"+String(o.getMonth()+1).padStart(2,"0")+"/"+o.getFullYear();
}
function toISO(d){
  if(!d)return"";
  if(/^\d{4}-\d{2}-\d{2}$/.test(d))return d;
  const m=d.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);
  if(m)return`${m[3]}-${m[2].padStart(2,"0")}-${m[1].padStart(2,"0")}`;
  return"";
}
function ageAt(birth,ref){
  const b=new Date(birth);
  if(isNaN(b))return"";
  const r=ref?new Date(ref):new Date();
  let y=r.getFullYear()-b.getFullYear();
  const m=r.getMonth()-b.getMonth();
  const d=r.getDate()-b.getDate();
  if(m<0||(m===0&&d<0))y--;
  return y;
}

/* === donnÃ©es === */
function load(){
  try{return JSON.parse(localStorage.getItem(KEY)||"[]");}
  catch(e){return[];}
}
function save(arr){
  localStorage.setItem(KEY,JSON.stringify(arr));
}

/* === rendu === */
function render(){
  const arr=load();
  const tb=document.getElementById("tbody");
  tb.innerHTML="";
  let h=0,d=0;
  arr.forEach(p=>{
    const tr=document.createElement("tr");
    if(p.decede)tr.style.opacity=.7;
    tr.innerHTML=`<td>${p.nom}</td>
    <td>${p.type==="Chien"?"ğŸ•":"ğŸ‘¤"}</td>
    <td>${fmtDateFr(p.naissance)}</td>
    <td>${ageAt(p.naissance,"")||""}</td>
    <td>${p.decede?fmtDateFr(p.deces):""}</td>
    <td>${p.decede?ageAt(p.naissance,p.deces):""}</td>
    <td>${p.notes||""}</td>`;
    tb.appendChild(tr);
    if(p.type==="Chien")d++;else h++;
  });
  document.getElementById("humBadge").textContent=h;
  document.getElementById("dogBadge").textContent=d;
}

/* === export CSV === */
function exportCSV(){
  const data=load();
  if(!data.length){alert("Aucune donnÃ©e Ã  sauvegarder");return;}
  const header="Nom;Type;Naissance;DÃ©cÃ©dÃ©;DÃ©cÃ¨s;Notes\n";
  const lines=data.map(p=>{
    return[
      p.nom,
      p.type,
      fmtDateFr(p.naissance),
      p.decede?"Oui":"Non",
      p.decede?fmtDateFr(p.deces):"",
      p.notes||""
    ].join(";");
  }).join("\n");
  const blob=new Blob([header+lines],{type:"text/csv;charset=utf-8;"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="BirthDay_"+new Date().toISOString().slice(0,10)+".csv";
  a.click();
  alert("âœ… Fichier CSV tÃ©lÃ©chargÃ©");
}

/* === import CSV === */
function parseCSV(text){
  const lines=text.split(/\r?\n/).filter(l=>l.trim()!=="");
  if(lines.length<2)return[];
  const out=[];
  for(let i=1;i<lines.length;i++){
    const c=lines[i].split(";");
    if(c.length<6)continue;
    const nom=c[0].trim();
    const type=c[1].trim();
    const nais=toISO(c[2].trim());
    const decede=/^oui$/i.test(c[3].trim());
    const deces=toISO(c[4].trim());
    const notes=c[5].trim();
    if(!nom||!nais)continue;
    out.push({nom,type,naissance:nais,decede,deces,notes});
  }
  return out;
}
function importCSV(file){
  const r=new FileReader();
  r.onload=e=>{
    const arr=parseCSV(e.target.result);
    if(!arr.length){alert("Import: aucune ligne valide.");return;}
    save(arr);
    render();
    alert("âœ… Import terminÃ© ("+arr.length+" lignes)");
  };
  r.readAsText(file,"utf-8");
}

/* === init === */
document.getElementById("btnExport").onclick=exportCSV;
document.getElementById("btnImportShow").onclick=()=>document.getElementById("btnImport").click();
document.getElementById("btnImport").onchange=e=>{
  const f=e.target.files[0];
  if(f)importCSV(f);
};
document.getElementById("today").textContent="Â· "+new Date().toLocaleDateString("fr-FR");

if(!load().length){
  save([
    {nom:"Alice Dupont",type:"Humain",naissance:"1990-10-05",decede:false,deces:"",notes:"Cousine"},
    {nom:"Rex",type:"Chien",naissance:"2017-12-01",decede:false,deces:"",notes:"Golden"},
    {nom:"Grand-PÃ¨re Paul",type:"Humain",naissance:"1942-02-29",decede:true,deces:"2018-10-19",notes:"Aimait le jardinage"}
  ]);
}
render();
</script>
</body>
</html>